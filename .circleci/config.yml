# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

orbs:
  macos: circleci/macos@2
  ruby: circleci/ruby@1.2.0
  android: circleci/android@1.0

# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/2.0/configuration-reference/#jobs
jobs:
  build-android:
    working_directory: ~/project/Android/2.0.0/DemoApp
    shell: /bin/bash --login -o pipefail
    executor:
      name: android/android-machine
      resource-class: large
    environment:
      FASTLANE_LANE: test
    steps:
      - checkout:
          path: ~/project
      - attach_workspace:
          at: ~/project
      - run: chmod a+x gradlew
      - run: ./gradlew assembleDebug
      - run: mkdir /tmp/artifacts && mv app/build/outputs/apk/debug/app-debug.apk /tmp/artifacts
      - store_artifacts:
          path: /tmp/artifacts


# Invoke jobs via workflows
# See: https://circleci.com/docs/2.0/configuration-reference/#workflows
workflows:
  build-and-test:
    jobs:
     - build-android
